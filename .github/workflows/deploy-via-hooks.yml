name: Deploy via hooks / deploy
on:
  push:
    branches: [ main ]
  pull_request:
permissions:
  contents: read
concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true
jobs:
  deploy:
    if: >
      (github.event_name == 'push' && github.ref == 'refs/heads/main') ||
      (github.event_name == 'pull_request' && contains(github.event.pull_request.labels.*.name, 'deploy'))
    runs-on: ubuntu-22.04
    steps:
      - uses: actions/checkout@v4
      - name: Trigger Vercel (main)
        if: github.event_name == 'push' && github.ref == 'refs/heads/main'
        run: curl -sS -X POST "${{ secrets.VERCEL_DEPLOY_HOOK }}"
      - name: Trigger Vercel (PR preview via label)
        if: github.event_name == 'pull_request' && contains(github.event.pull_request.labels.*.name, 'deploy')
        run: curl -sS -X POST "${{ secrets.VERCEL_PREVIEW_DEPLOY_HOOK }}"
