(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8872],{865:(e,t,n)=>{"use strict";n.d(t,{ConfirmAgreementButton:()=>r});var a=n(5155),l=n(9893);function r(e){let{agreementId:t}=e;async function n(e){let t=await fetch("/api/agreements/".concat(e,"/confirm"),{method:"POST"}),n=await t.json();if(!t.ok||!(null==n?void 0:n.ok))throw Error((null==n?void 0:n.error)||"Failed");alert("Agreement confirmed. 1 ticket was spent from both parties.")}return(0,a.jsx)(l.$,{need:1,children:e=>(0,a.jsx)("button",{id:"agree-accept",className:"rounded-md px-4 py-2 border disabled:opacity-50",disabled:!e,onClick:()=>e?n(t).catch(e=>alert((null==e?void 0:e.message)||"Failed")):alert("You need 1 ticket to confirm an agreement."),children:"Confirm agreement"})})}},3837:(e,t,n)=>{"use strict";n.d(t,{CancelAgreementButton:()=>c});var a=n(5155),l=n(2115);async function r(e){var t;let n=await fetch("/api/agreements/".concat(e,"/cancel"),{method:"POST"}),a=await n.json();if(!n.ok||!(null==a?void 0:a.ok))throw Error(null!=(t=null==a?void 0:a.error)?t:"cancel_failed");return a}function c(e){let{id:t}=e,[n,c]=(0,l.useState)(!1);return(0,a.jsx)("button",{className:"btn-outline",disabled:n,onClick:async()=>{if(confirm("Cancel this agreement? 1 ticket will be returned to each party.")){c(!0);try{await r(t),alert("Agreement cancelled. Tickets refunded to both parties."),location.reload()}catch(t){var e;alert(null!=(e=null==t?void 0:t.message)?e:"Unable to cancel")}finally{c(!1)}}},children:"Cancel agreement"})}},6087:(e,t,n)=>{"use strict";n.d(t,{default:()=>r});var a=n(5155),l=n(2115);function r(e){let{acceptButtonId:t}=e,[n,r]=(0,l.useState)(null);return(0,l.useEffect)(()=>{fetch("/api/tickets/balance").then(e=>e.json()).then(e=>r("number"==typeof(null==e?void 0:e.balance)?e.balance:0)).catch(()=>r(null))},[]),(0,l.useEffect)(()=>{if(!t||null===n)return;let e=document.getElementById(t);e&&(e.disabled=n<=0,e.title=n<=0?"You need at least 1 ticket to accept":"")},[t,n]),(0,a.jsxs)("div",{className:"rounded border p-3 bg-gray-50",children:[(0,a.jsxs)("div",{className:"text-sm text-gray-600",children:["Ticket cost to accept: ",(0,a.jsx)("b",{children:"1"})]}),(0,a.jsxs)("div",{className:"text-sm",children:["Your balance:"," ",(0,a.jsx)("b",{className:null!==n&&n<=0?"text-red-600":"text-gray-900",children:null===n?"â€¦":n})]}),null!==n&&n<=0&&(0,a.jsx)("div",{className:"mt-1 text-xs text-red-600",children:"Not enough tickets."})]})}},6672:(e,t,n)=>{Promise.resolve().then(n.bind(n,6087)),Promise.resolve().then(n.bind(n,3837)),Promise.resolve().then(n.bind(n,865))},9893:(e,t,n)=>{"use strict";n.d(t,{$:()=>r});var a=n(5155),l=n(2115);function r(e){let{need:t=1,children:n}=e,[r,c]=(0,l.useState)(null),[i,s]=(0,l.useState)(!1);async function o(){s(!0);try{var e;let n=await fetch("/api/tickets/spend",{method:"POST",body:JSON.stringify({amount:t,reason:"action"})});if(!n.ok)return!1;let a=await n.json();return c(Number(null!=(e=null==a?void 0:a.balance)?e:0)),!0}finally{s(!1)}}return(0,l.useEffect)(()=>{fetch("/api/tickets/balance",{cache:"no-store"}).then(e=>e.json()).then(e=>{var t;return c(Number(null!=(t=null==e?void 0:e.balance)?t:0))}).catch(()=>c(0))},[]),(0,a.jsx)(a.Fragment,{children:n((null!=r?r:0)>=t&&!i,o)})}}},e=>{e.O(0,[8441,1255,7358],()=>e(e.s=6672)),_N_E=e.O()}]);