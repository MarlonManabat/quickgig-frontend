(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2788],{1941:(e,t,a)=>{Promise.resolve().then(a.bind(a,5430))},1989:(e,t,a)=>{"use strict";a.d(t,{L:()=>l});var s=a(2659),n=a(5704);let i=null;function l(){if(i)return i;let e=n.env.NEXT_PUBLIC_SUPABASE_URL,t=n.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;return e&&t?i=(0,s.UU)(e,t,{auth:{persistSession:!0,autoRefreshToken:!0}}):null}},4602:(e,t,a)=>{"use strict";a.d(t,{TD:()=>l,bw:()=>n,w3:()=>i});var s=a(5704);let n={home:"/",browseJobs:"/browse-jobs",postJob:"/gigs/create",applications:"/applications",login:"/login",signup:"/signup",logout:"/logout",tickets:"/tickets",ticketsBuy:"/tickets/buy",agreements:"/agreements",billingTickets:"/billing/tickets",accountTickets:"/account/tickets",adminTickets:"/admin/tickets"};function i(e){let t=s.env.NEXT_PUBLIC_APP_ORIGIN;return t?new URL(e,t).toString():e}let l=[{key:"browse-jobs",label:"Browse jobs",to:n.browseJobs,id:"nav-browse-jobs",auth:"none"},{key:"post-job",label:"Post a job",to:n.postJob,id:"nav-post-job",auth:"auth-aware"},{key:"applications",label:"My Applications",to:n.applications,id:"nav-my-applications",auth:"auth-aware"},{key:"tickets",label:"Tickets",to:n.tickets,id:"nav-tickets",auth:"auth-aware"},{key:"login",label:"Login",to:n.login,id:"nav-login",auth:"none"}]},5430:(e,t,a)=>{"use strict";a.d(t,{default:()=>v});var s,n=a(5155),i=a(2115);let l={success(e){window.alert(e)},error(e){window.alert(e)},info(e){window.alert(e)}};var r=a(5239),o=a(1989),c=a(4152),d=a(5704);function u(e){let{open:t,onClose:a,pricePHP:s,credits:l,next:u,onStart:p,onDone:h,onError:b}=e,v=(0,o.L)(),[f,m]=i.useState(null),[x,g]=i.useState(!1),[k,w]=i.useState(null),_=async()=>{if(!f)return;g(!0),w(null),null==p||p();let{data:{user:e}}=await v.auth.getUser();if(!e){w("Please sign in first."),g(!1),null==b||b();return}let t=(f.name.split(".").pop()||"jpg").toLowerCase(),n="proofs/".concat(e.id,"/").concat(Date.now(),"-").concat((0,c.Ak)(),".").concat(t),i=await v.storage.from("payments").upload(n,f);if(i.error){w(i.error.message),g(!1),null==b||b();return}if(!(await fetch("/api/orders/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount:s,credits:l,proof_path:n,next:u})})).ok){w("Failed to create order"),g(!1),null==b||b();return}null==h||h(),g(!1),a(),alert("Thanks! Your payment is under review.")};return t?(0,n.jsx)("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:(0,n.jsxs)("div",{className:"bg-white rounded-2xl p-6 w-full max-w-md space-y-4",children:[(0,n.jsx)("h2",{className:"text-xl font-semibold",children:"Buy posting credits"}),(0,n.jsxs)("p",{children:["Send ",(0,n.jsxs)("b",{children:["₱",s]})," via GCash and upload the receipt."]}),d.env.NEXT_PUBLIC_GCASH_QR_URL&&(0,n.jsx)(r.default,{src:d.env.NEXT_PUBLIC_GCASH_QR_URL,alt:"GCash QR",width:192,height:192,className:"w-48 h-48 mx-auto rounded"}),(0,n.jsx)("input",{type:"file",accept:"image/*",onChange:e=>{var t;return m((null==(t=e.target.files)?void 0:t[0])||null)}}),k&&(0,n.jsx)("p",{className:"text-sm text-red-600",children:k}),(0,n.jsxs)("div",{className:"flex gap-2 justify-end",children:[(0,n.jsx)("button",{className:"px-3 py-2 rounded-xl border",onClick:a,disabled:x,children:"Cancel"}),(0,n.jsx)("button",{className:"px-3 py-2 rounded-xl bg-black text-white",onClick:_,disabled:!f||x,children:"Submit"})]})]})}):null}var p=a(5704);let h=Number(null!=(s=p.env.NEXT_PUBLIC_TICKET_PRICE_PHP)?s:20);p.env.FREE_TICKETS_ON_SIGNUP,p.env.GCASH_PAYEE_NAME,p.env.GCASH_NUMBER,p.env.GCASH_QR_URL,p.env.GCASH_NOTES;var b=a(4602);function v(e){let{initialBalance:t,next:a}=e,[s,r]=(0,i.useState)(t),[o,c]=(0,i.useState)(!1),[d,p]=(0,i.useState)(!1),[v,f]=(0,i.useState)(!1);return(0,i.useEffect)(()=>{if(!v)return;let e=0,t=setInterval(async()=>{e++;try{let e=await fetch("/api/billing/balance",{cache:"no-store"});if(e.ok){let{balance:t}=await e.json();r(t),t>=1&&(l.success("Tickets credited!"),a?location.replace(a):location.replace(b.bw.postJob))}}catch(e){}e>22&&(clearInterval(t),f(!1),l.info("Still pending approval. We’ll credit your ticket once verified."))},8e3);return()=>clearInterval(t)},[v,a]),(0,n.jsxs)("div",{className:"space-y-4",children:[t>=1&&(0,n.jsxs)("div",{className:"rounded-lg border p-3 bg-green-50",children:["You’ve received ",t," free starter ",1===t?"ticket":"tickets"," \uD83C\uDF89"]}),(0,n.jsxs)("div",{className:"rounded-lg border p-3",children:[(0,n.jsx)("div",{className:"text-sm opacity-70",children:"Current tickets"}),(0,n.jsx)("div",{className:"text-3xl font-semibold",children:s})]}),(0,n.jsx)("button",{className:"rounded-xl border px-4 py-2",onClick:()=>c(!0),disabled:d,children:"Upload GCash proof"}),(0,n.jsx)(u,{open:o,onClose:()=>c(!1),pricePHP:h,credits:1,next:a||void 0,onStart:()=>p(!0),onDone:()=>{p(!1),l.success("Proof submitted. Waiting for admin approval…"),f(!0)},onError:()=>{p(!1),l.error("Upload failed. Please try again.")}}),!v&&(0,n.jsx)("p",{className:"text-sm opacity-70",children:"After you upload your GCash receipt, we’ll automatically credit your ticket once approved."}),v&&(0,n.jsx)("p",{className:"text-sm",children:"Waiting for approval… we’ll check every few seconds. You can leave this page."})]})}}},e=>{e.O(0,[2659,6850,8441,1255,7358],()=>e(e.s=1941)),_N_E=e.O()}]);