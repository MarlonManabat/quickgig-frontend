(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9145],{1989:(e,t,n)=>{"use strict";n.d(t,{L:()=>l});var a=n(2659),i=n(5704);let s=null;function l(){if(s)return s;let e=i.env.NEXT_PUBLIC_SUPABASE_URL,t=i.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;return e&&t?s=(0,a.UU)(e,t,{auth:{persistSession:!0,autoRefreshToken:!0}}):null}},4602:(e,t,n)=>{"use strict";n.d(t,{TD:()=>l,bw:()=>i,w3:()=>s});var a=n(5704);let i={home:"/",browseJobs:"/browse-jobs",postJob:"/gigs/create",applications:"/applications",login:"/login",signup:"/signup",logout:"/logout",tickets:"/tickets",ticketsBuy:"/tickets/buy",agreements:"/agreements",billingTickets:"/billing/tickets",accountTickets:"/account/tickets",adminTickets:"/admin/tickets"};function s(e){let t=a.env.NEXT_PUBLIC_APP_ORIGIN;return t?new URL(e,t).toString():e}let l=[{key:"browse-jobs",label:"Browse jobs",to:i.browseJobs,id:"nav-browse-jobs",auth:"none"},{key:"post-job",label:"Post a job",to:i.postJob,id:"nav-post-job",auth:"auth-aware"},{key:"applications",label:"My Applications",to:i.applications,id:"nav-my-applications",auth:"auth-aware"},{key:"tickets",label:"Tickets",to:i.tickets,id:"nav-tickets",auth:"auth-aware"},{key:"login",label:"Login",to:i.login,id:"nav-login",auth:"none"}]},7336:(e,t,n)=>{"use strict";n.d(t,{ApplyPanel:()=>u});var a=n(5155),i=n(2115),s=n(1989),l=n(9893),o=n(4602);function u(e){let{gigId:t}=e,{user:n}=function(){let e=(0,s.L)(),[t,n]=(0,i.useState)(!0),[a,l]=(0,i.useState)(null);return(0,i.useEffect)(()=>{let t=!0;e.auth.getUser().then(e=>{var a;let{data:i}=e;t&&(l(i.user?{id:i.user.id,email:null!=(a=i.user.email)?a:void 0}:null),n(!1))});let{data:a}=e.auth.onAuthStateChange((e,t)=>{var n;l((null==t?void 0:t.user)?{id:t.user.id,email:null!=(n=t.user.email)?n:void 0}:null)});return()=>{t=!1,null==a||a.subscription.unsubscribe()}},[e.auth]),{user:a,loading:t,signOut:()=>e.auth.signOut()}}(),[u,r]=(0,i.useState)(!1),[c,d]=(0,i.useState)(!1),[p,b]=(0,i.useState)();async function h(){var e;r(!0),b(void 0);let a=await fetch("/api/applications",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({gig_id:t,user_id:null!=(e=null==n?void 0:n.id)?e:null})}),i=await a.json();if(!a.ok){b(i.error||"Failed"),r(!1);return}d(!0),r(!1)}return n?c?(0,a.jsx)("p",{className:"text-green-700",children:"Application submitted."}):(0,a.jsxs)("div",{className:"space-y-2",children:[p&&(0,a.jsx)("p",{className:"text-red-600",children:p}),(0,a.jsx)(l.$,{need:1,children:e=>(0,a.jsx)("button",{disabled:!e||u,onClick:()=>e?h():alert("You need 1 ticket to apply. Check your balance or earn more."),className:"rounded bg-black text-white px-4 py-2",children:"Apply"})})]}):(0,a.jsxs)("p",{className:"text-slate-600",children:["Please"," ",(0,a.jsx)("a",{className:"underline",href:o.bw.login,children:"sign in"})," ","to apply."]})}},9090:(e,t,n)=>{Promise.resolve().then(n.bind(n,7336))},9893:(e,t,n)=>{"use strict";n.d(t,{$:()=>s});var a=n(5155),i=n(2115);function s(e){let{need:t=1,children:n}=e,[s,l]=(0,i.useState)(null),[o,u]=(0,i.useState)(!1);async function r(){u(!0);try{var e;let n=await fetch("/api/tickets/spend",{method:"POST",body:JSON.stringify({amount:t,reason:"action"})});if(!n.ok)return!1;let a=await n.json();return l(Number(null!=(e=null==a?void 0:a.balance)?e:0)),!0}finally{u(!1)}}return(0,i.useEffect)(()=>{fetch("/api/tickets/balance",{cache:"no-store"}).then(e=>e.json()).then(e=>{var t;return l(Number(null!=(t=null==e?void 0:e.balance)?t:0))}).catch(()=>l(0))},[]),(0,a.jsx)(a.Fragment,{children:n((null!=s?s:0)>=t&&!o,r)})}}},e=>{e.O(0,[2659,8441,1255,7358],()=>e(e.s=9090)),_N_E=e.O()}]);