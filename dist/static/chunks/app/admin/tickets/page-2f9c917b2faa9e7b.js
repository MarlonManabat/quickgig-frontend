(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1524],{6657:(e,l,s)=>{"use strict";s.r(l),s.d(l,{default:()=>r});var t=s(5155),a=s(2115);function r(){let[e,l]=(0,a.useState)([]),[s,r]=(0,a.useState)(null),[n,d]=(0,a.useState)("");(0,a.useEffect)(()=>{(async()=>{var e,s,t,a;let n=await fetch("/api/me").then(e=>e.ok?e.json():null).catch(()=>null),d=!!((null==n||null==(e=n.profile)?void 0:e.is_admin)||(null==n||null==(t=n.user)||null==(s=t.app_metadata)?void 0:s.role)==="admin");if(r(d),!d)return;let c=await fetch("/api/admin/tickets/list?limit=200").then(e=>e.json());l(null!=(a=null==c?void 0:c.rows)?a:[])})()},[]);let c=(0,a.useMemo)(()=>{if(!n)return e;let l=n.toLowerCase();return e.filter(e=>{var s,t;return e.user_id.toLowerCase().includes(l)||(null!=(s=e.source)?s:"").toLowerCase().includes(l)||(null!=(t=e.ref_id)?t:"").toLowerCase().includes(l)})},[e,n]);if(null===s)return(0,t.jsx)("div",{className:"p-6",children:"Loading…"});if(!s)return(0,t.jsx)("div",{className:"p-6",children:"Forbidden."});let i=e.reduce((e,l)=>e+(l.delta||0),0);return(0,t.jsxs)("div",{className:"p-6 space-y-4",children:[(0,t.jsxs)("div",{className:"flex items-baseline gap-4",children:[(0,t.jsx)("h1",{className:"text-2xl font-semibold",children:"Admin \xb7 Ticket ledger"}),(0,t.jsxs)("span",{className:"px-2 py-1 rounded bg-gray-100 text-sm",children:["Loaded: ",e.length," \xb7 Net Δ: ",i>=0?"+".concat(i):i]}),(0,t.jsx)("input",{placeholder:"Filter: user_id / source / ref",value:n,onChange:e=>d(e.target.value),className:"border rounded px-2 py-1 text-sm flex-1"})]}),(0,t.jsx)("div",{className:"overflow-x-auto border rounded",children:(0,t.jsxs)("table",{className:"min-w-full text-sm",children:[(0,t.jsx)("thead",{className:"bg-gray-50 text-left",children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{className:"p-2",children:"When"}),(0,t.jsx)("th",{className:"p-2",children:"User"}),(0,t.jsx)("th",{className:"p-2",children:"Δ"}),(0,t.jsx)("th",{className:"p-2",children:"Source"}),(0,t.jsx)("th",{className:"p-2",children:"Ref"})]})}),(0,t.jsxs)("tbody",{children:[c.map(e=>{var l,s;return(0,t.jsxs)("tr",{className:"border-t",children:[(0,t.jsx)("td",{className:"p-2",children:new Date(e.created_at).toLocaleString()}),(0,t.jsx)("td",{className:"p-2 font-mono text-[11px]",children:e.user_id}),(0,t.jsx)("td",{className:"p-2 ".concat(e.delta>0?"text-green-600":e.delta<0?"text-red-600":""),children:e.delta>0?"+".concat(e.delta):e.delta}),(0,t.jsx)("td",{className:"p-2",children:null!=(l=e.source)?l:"—"}),(0,t.jsx)("td",{className:"p-2 font-mono text-[11px]",children:null!=(s=e.ref_id)?s:"—"})]},e.id)}),0===c.length&&(0,t.jsx)("tr",{children:(0,t.jsx)("td",{colSpan:5,className:"p-3 text-gray-500",children:"No matching rows."})})]})]})})]})}},9727:(e,l,s)=>{Promise.resolve().then(s.bind(s,6657))}},e=>{e.O(0,[8441,1255,7358],()=>e(e.s=9727)),_N_E=e.O()}]);